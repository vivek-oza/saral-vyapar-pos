# Story 1.1: User & Shop Onboarding

## Status

Approved

## Story

**As a** new business owner,
**I want** to create an account and set up my shop details in a single, guided flow,
**so that** I can quickly start using the POS system without confusion

## Acceptance Criteria

1. User can sign up with email and password
2. User must verify email via a 6-digit OTP before login is permitted
2. User is immediately guided through shop setup after account creation
3. Shop setup includes: Shop Name, Unique Shop Username, Address, GST number
4. Shop username must be unique, contain only letters, numbers, and underscores
5. User is redirected to module selection page at /{shopusername}/modules after completion
6. User can log in securely with credentials
7. User is redirected to module selection page at /{shopusername}/modules upon successful login
8. User can access full dashboard from module selection page if needed

## Tasks / Subtasks

- [ ] Task 1: Set up project structure and dependencies (AC: 1-6)
  - [ ] Initialize React project with Vite
  - [ ] Install and configure Shadcn UI components
  - [ ] Set up React Router for navigation
  - [ ] Configure Axios for API communication
- [ ] Task 2: Create authentication system (AC: 1, 5)
  - [ ] Implement signup API endpoint with JWT authentication
  - [ ] Implement login API endpoint with JWT validation
  - [ ] Set up password hashing with bcrypt
  - [ ] Create JWT middleware for protected routes
- [ ] Task 3: Build signup and login UI components (AC: 1, 5)
  - [ ] Create SignupForm component with email/password fields
  - [ ] Create LoginForm component with email/password fields
  - [ ] Implement form validation and error handling
  - [ ] Add loading states and success feedback
- [ ] Task 4: Implement shop setup flow (AC: 2, 3)
  - [ ] Create ShopSetupForm component with name, address, GST fields
  - [ ] Implement guided step-by-step flow
  - [ ] Add form validation for required fields
  - [ ] Create shop creation API endpoint
- [ ] Task 5: Build main dashboard and navigation (AC: 4, 6)
  - [ ] Create Dashboard component with KPI widgets
  - [ ] Implement navigation bar with menu items
  - [ ] Set up protected route wrapper
  - [ ] Add logout functionality
- [ ] Task 6: Implement state management and routing (AC: 4, 6)
  - [ ] Set up React Context for user authentication state
  - [ ] Configure protected routes for authenticated users
  - [ ] Implement automatic redirects based on auth status
  - [ ] Add route guards for unauthenticated access

## Dev Notes

### Previous Story Insights

No previous stories exist - this is the first story of the project.

### Data Models

Based on architecture document, the following schemas will be implemented:

**User Schema:**

- `email`: { type: String, required: true, unique: true }
- `password`: { type: String, required: true }

**Shop Schema:**

- `owner`: { type: ObjectId, ref: 'User' }
- `name`: { type: String, required: true }
- `address`: { type: String }
- `gstNumber`: { type: String }

[Source: docs/architecture/01-system-architecture-document-saral-vyapar.md#4.3 Database (Persistence)]

### API Specifications

**Authentication Endpoints:**

- `POST /api/auth/signup` - Creates new user (email not verified yet)
- `POST /api/auth/verify-otp` - Verifies email using 6-digit OTP
- `POST /api/auth/login` - Authenticates verified user and returns JWT
- `GET /api/auth/me` - Returns current authenticated user with profile and shop
- `POST /api/shop/setup` - Creates/updates shop after login

**JWT Authentication Workflow:**

1. User signs in with email/password
2. Server validates credentials and generates signed JWT containing `userId`
3. Server sends JWT back to client
4. Client stores JWT securely and includes in `Authorization: Bearer <token>` header
5. Client hydrates current user on app load using `GET /api/auth/me`
6. Custom middleware verifies JWT on protected routes

[Source: docs/architecture/01-system-architecture-document-saral-vyapar.md#4.2 Backend (Server)]

### Component Specifications

**Frontend Framework:** React 18+ with Shadcn UI components
**State Management:** React Context API for global authentication state
**Routing:** React Router for client-side navigation
**API Communication:** Axios library with JWT auto-inclusion

[Source: docs/architecture/01-system-architecture-document-saral-vyapar.md#4.1 Frontend (Client)]

### File Locations

Based on project structure, new code should be created in:

- `src/components/auth/` - Authentication components (SignupForm, LoginForm)
- `src/components/shop/` - Shop setup components (ShopSetupForm)
- `src/components/dashboard/` - Dashboard and navigation components
- `src/contexts/` - React Context providers (AuthContext)
- `src/pages/` - Page components (Signup, Login, Dashboard)
- `src/api/` - API service functions
- `src/utils/` - Utility functions (validation, helpers)

### Testing Requirements

**Testing Framework:** No specific testing guidance found in architecture docs
**Test Location:** Tests should be co-located with components in `src/components/**/__tests__/` directories
**Test Coverage:** Unit tests for all components, integration tests for authentication flow

### Technical Constraints

**Security Requirements:**

- Passwords must be hashed using bcrypt before storage
- JWT tokens must be securely stored and transmitted
- All API endpoints must validate and sanitize input data
- CORS must be configured to only allow frontend domain

**Performance Considerations:**

- JWT-based API allows for stateless horizontal scaling
- React code splitting should be implemented for optimal page load times

[Source: docs/architecture/01-system-architecture-document-saral-vyapar.md#6. Security, Scalability & Performance]

## Testing

**Testing Standards:**

- Unit tests for all React components using React Testing Library
- Integration tests for authentication flow and API endpoints
- Test files should be co-located with components in `__tests__` directories
- Mock external dependencies (API calls, localStorage) in tests
- Test both success and error scenarios for all user interactions

## Change Log

| Date       | Version | Description                                                  | Author              |
| ---------- | ------- | ------------------------------------------------------------ | ------------------- |
| 2025-01-27 | 1.0     | Initial story creation                                       | Bob (Scrum Master)  |
| 2025-01-27 | 1.1     | Updated to redirect to module selection instead of dashboard | Kiro (AI Assistant) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_This section will be populated by the QA agent during review_
