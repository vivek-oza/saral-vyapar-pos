# Story 4.1: KPI Dashboard Foundation

## Status

Approved

## Story

**As a** shop owner,
**I want** to see key business metrics and performance indicators on my dashboard,
**so that** I can quickly understand my business performance and make informed decisions

## Prerequisites

- Story 1.1 (User & Shop Onboarding) must be completed
- Story 1.3 (Module Selection Interface) must be completed
- Story 3.1 (Core Billing Interface) should be completed for meaningful data
- User can access dashboard via "Go to Full Dashboard" button from module selection or hamburger menu

## Acceptance Criteria

1. User can access Dashboard from module selection page or hamburger menu
2. Dashboard enhances the current basic implementation with KPI widgets
3. Dashboard displays Today's Sales amount prominently
4. Dashboard shows Top 5 Selling Products by revenue
5. Dashboard displays Peak Sales Hours chart/graph
6. Dashboard shows Number of Bills generated today
7. All metrics are real-time and update automatically
8. Dashboard is responsive and works on mobile devices
9. User can view metrics for different time periods (today, week, month)
10. Dashboard loads quickly with skeleton loading states
11. Dashboard maintains existing Layout component with hamburger navigation

## Tasks / Subtasks

- [ ] Task 1: Create dashboard layout and structure (AC: 1-8)
  - [ ] Implement responsive dashboard grid layout
  - [ ] Create KPI card components for each metric
  - [ ] Add skeleton loading states for better UX
  - [ ] Implement mobile-responsive design
- [ ] Task 2: Build Today's Sales KPI widget (AC: 1, 5)
  - [ ] Create sales amount display with currency formatting
  - [ ] Implement real-time sales calculation
  - [ ] Add visual indicators for sales performance
  - [ ] Include comparison with previous day
- [ ] Task 3: Implement Top Selling Products widget (AC: 2, 5)
  - [ ] Create product ranking list with revenue data
  - [ ] Display product name, quantity sold, and revenue
  - [ ] Add product images for easy identification
  - [ ] Implement sorting by revenue and quantity
- [ ] Task 4: Build Peak Sales Hours visualization (AC: 3, 5)
  - [ ] Create hourly sales chart using Chart.js or similar
  - [ ] Implement data aggregation by hour
  - [ ] Add interactive chart with tooltips
  - [ ] Include peak hours highlighting
- [ ] Task 5: Create Bills Count widget (AC: 4, 5)
  - [ ] Display total bills generated today
  - [ ] Show bills by payment method breakdown
  - [ ] Add comparison with previous periods
  - [ ] Include bill status distribution
- [ ] Task 6: Implement time period filtering (AC: 7)
  - [ ] Add date range selector (today, week, month)
  - [ ] Update all metrics based on selected period
  - [ ] Implement period comparison functionality
  - [ ] Add quick period switching buttons

## Dev Notes

### Previous Story Insights

This story builds on Epic 1 (User & Shop Onboarding), Epic 2 (Product & Inventory Management), and Epic 3 (Core Billing Engine) and requires the billing system and product management to be complete.

### Data Models

**Sales Analytics Schema (Draft):**

- `shop`: { type: ObjectId, ref: 'Shop', required: true }
- `date`: { type: Date, required: true }
- `totalSales`: { type: Number, required: true }
- `totalBills`: { type: Number, required: true }
- `hourlySales`: [ { `hour`: Number, `sales`: Number, `bills`: Number } ]
- `topProducts`: [ { `productId`: ObjectId, `name`: String, `quantity`: Number, `revenue`: Number } ]
- `paymentBreakdown`: { `cash`: Number, `card`: Number, `upi`: Number }

**Bill Schema (from Story 3.1):**

- `shop`, `billNumber`, `timestamp`, `totalAmount`, `paymentMode`, `status`

[Source: docs/architecture/01-system-architecture-document-saral-vyapar.md#4.3 Database (Persistence)]

### API Specifications

**Analytics Endpoints:**

- `GET /api/analytics/dashboard?period={period}` - Get dashboard metrics
- `GET /api/analytics/sales?period={period}` - Get sales data for period
- `GET /api/analytics/products/top-selling?period={period}&limit={limit}` - Get top products
- `GET /api/analytics/hours/peak?period={period}` - Get peak hours data

**Query Parameters:**

- `period` - Time period (today, week, month, custom)
- `startDate` - Custom start date (ISO format)
- `endDate` - Custom end date (ISO format)
- `limit` - Number of top products to return

**Response Structure:**

```json
{
  "period": "today",
  "sales": {
    "total": 25000,
    "previousPeriod": 22000,
    "change": 13.64
  },
  "bills": {
    "total": 45,
    "byPaymentMode": { "cash": 20, "card": 15, "upi": 10 }
  },
  "topProducts": [...],
  "peakHours": [...]
}
```

### Component Specifications

**Frontend Components:**

- `Dashboard` - Main dashboard container with grid layout
- `KPICard` - Reusable KPI display component
- `SalesWidget` - Today's sales display with trends
- `TopProductsWidget` - Top selling products list
- `PeakHoursChart` - Hourly sales visualization
- `BillsWidget` - Bills count and breakdown
- `PeriodSelector` - Time period filter component
- `SkeletonLoader` - Loading state components

**Dashboard Layout:**

```
┌─────────────────────────────────────────────────────────┐
│                    Dashboard Header                      │
├─────────────────────┬───────────────────────────────────┤
│    Today's Sales    │        Top Products              │
│       ₹25,000       │     ┌─────────────────────────┐   │
│     +13.6% ↑        │     │ 1. Product A - ₹5,000   │   │
└─────────────────────┘     │ 2. Product B - ₹4,500   │   │
├─────────────────────┬─────│ 3. Product C - ₹4,000   │   │
│   Bills Today: 45   │    │ 4. Product D - ₹3,500   │   │
│  Cash: 20 | Card: 15│    │ 5. Product E - ₹3,000   │   │
└─────────────────────┴─────└─────────────────────────┘   │
│                                                         │
│              Peak Sales Hours Chart                     │
│        [Hourly bar chart showing 10AM-8PM peak]        │
└─────────────────────────────────────────────────────────┘
```

### File Locations

- `src/components/dashboard/Dashboard.tsx`
- `src/components/dashboard/KPICard.tsx`
- `src/components/dashboard/SalesWidget.tsx`
- `src/components/dashboard/TopProductsWidget.tsx`
- `src/components/dashboard/PeakHoursChart.tsx`
- `src/components/dashboard/BillsWidget.tsx`
- `src/components/dashboard/PeriodSelector.tsx`
- `src/components/dashboard/SkeletonLoader.tsx`
- `src/pages/Dashboard.tsx`
- `src/api/analytics.ts` - Analytics API functions
- `src/utils/analyticsUtils.ts` - Data processing and formatting
- `src/utils/chartUtils.ts` - Chart configuration helpers

### Testing Requirements

**Test Coverage:**

- Unit tests for all dashboard components
- KPI calculation testing with various data scenarios
- Chart rendering and interaction testing
- API integration testing with mock data
- Responsive design testing
- Performance testing for real-time updates

### Technical Constraints

**Performance Requirements:**

- Dashboard load time: < 2 seconds
- Real-time updates: Every 30 seconds
- Chart rendering: < 500ms
- Mobile performance: Smooth scrolling and interactions

**Data Requirements:**

- Real-time calculations from bill data
- Aggregated analytics for performance
- Cached data for faster loading
- Fallback data for offline scenarios

**Chart Library:**

- Chart.js or Recharts for data visualization
- Responsive charts that work on mobile
- Interactive tooltips and legends
- Export functionality for reports

**Business Logic:**

- Sales calculation: Sum of completed bills for period
- Top products: Ranked by revenue, then quantity
- Peak hours: Hourly aggregation of bill timestamps
- Period comparison: Current vs previous period metrics

## Testing

**Testing Standards:**

- Unit tests for all dashboard components using React Testing Library
- KPI calculation testing with edge cases and zero values
- Chart component testing with various data sets
- API integration testing with mocked responses
- Responsive design testing across different screen sizes
- Performance testing for dashboard load times and updates

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-27 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_This section will be populated by the QA agent during review_
