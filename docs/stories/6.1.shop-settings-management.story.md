# Story 6.1: Shop Settings Management

## Status

In Progress

## Story

**As a** shop owner,
**I want** to manage my shop profile and configure system settings,
**so that** I can customize the application according to my business needs

## Acceptance Criteria

1. User can access Shop Settings from the module selection page at `/{shopusername}/modules`
2. Shop Settings page enhances the current read-only implementation
3. User can view current shop profile information (name, address, GST, created date/time, etc.)
4. User can edit shop profile information (name, address, GST)
5. User can configure tax rates and rules for billing
6. User can set up business hours and operating schedule
7. User can customize dashboard layout and preferences
8. User can configure notification and alert preferences
9. User can export business data for backup purposes
10. User can manage system preferences and regional settings
11. All settings are saved and persist across sessions
12. User can navigate back to module selection via "Back to Modules" button

## Tasks / Subtasks

- [ ] Task 1: Create settings data models and API (AC: 1-8)
  - [ ] Implement ShopSettings schema with configuration fields
  - [ ] Create settings CRUD API endpoints
  - [ ] Add settings validation and business rules
  - [ ] Implement settings persistence and caching
- [ ] Task 2: Build shop profile management (AC: 1)
  - [ ] Create ShopProfileForm component for editing
  - [ ] Implement profile validation and update functionality
  - [ ] Add shop logo and branding upload
  - [ ] Build profile preview and confirmation
- [ ] Task 3: Implement tax and pricing configuration (AC: 2)
  - [ ] Create TaxSettings component with rate configuration
  - [ ] Implement tax calculation rules and formulas
  - [ ] Add tax exemption and special rate handling
  - [ ] Build tax preview and testing functionality
- [ ] Task 4: Add business hours and schedule management (AC: 3)
  - [ ] Create BusinessHours component with weekly schedule
  - [ ] Implement holiday and special day configuration
  - [ ] Add operating hours validation and conflicts checking
  - [ ] Build schedule preview and calendar view
- [ ] Task 5: Create dashboard customization features (AC: 4)
  - [ ] Implement DashboardSettings component
  - [ ] Add widget arrangement and sizing controls
  - [ ] Create theme and color scheme selection
  - [ ] Build layout preview and customization
- [ ] Task 6: Implement notification and data management (AC: 5-6)
  - [ ] Create NotificationSettings component
  - [ ] Add email and in-app notification preferences
  - [ ] Implement data export functionality (CSV, PDF)
  - [ ] Build backup and restore capabilities

## Dev Notes

### Previous Story Insights

This story builds on Epic 1 (User & Shop Onboarding) and requires the authentication system and shop setup to be complete.

### Data Models

**ShopSettings Schema:**

- `shop`: { type: ObjectId, ref: 'Shop', required: true }
- `profile`: {
  `name`: { type: String, required: true, trim: true },
  `address`: { type: String, trim: true },
  `gstNumber`: { type: String, trim: true },
  `phone`: { type: String, trim: true },
  `email`: { type: String, trim: true, lowercase: true },
  `logo`: { type: String, trim: true },
  `currency`: { type: String, default: 'INR' },
  `timezone`: { type: String, default: 'Asia/Kolkata' }
  }
- `tax`: {
  `enabled`: { type: Boolean, default: true },
  `rate`: { type: Number, default: 18, min: 0, max: 100 },
  `exemptCategories`: [ { type: String, trim: true } ],
  `inclusive`: { type: Boolean, default: false }
  }
- `businessHours`: {
  `monday`: { `open`: String, `close`: String, `closed`: Boolean },
  `tuesday`: { `open`: String, `close`: String, `closed`: Boolean },
  `wednesday`: { `open`: String, `close`: String, `closed`: Boolean },
  `thursday`: { `open`: String, `close`: String, `closed`: Boolean },
  `friday`: { `open`: String, `close`: String, `closed`: Boolean },
  `saturday`: { `open`: String, `close`: String, `closed`: Boolean },
  `sunday`: { `open`: String, `close`: String, `closed`: Boolean }
  }
- `dashboard`: {
  `layout`: { type: String, enum: ['grid', 'list'], default: 'grid' },
  `theme`: { type: String, enum: ['light', 'dark'], default: 'light' },
  `widgets`: [ { `id`: String, `enabled`: Boolean, `position`: Number } ]
  }
- `notifications`: {
  `email`: { type: Boolean, default: true },
  `lowStock`: { type: Boolean, default: true },
  `dailyReport`: { type: Boolean, default: false },
  `weeklyReport`: { type: Boolean, default: true }
  }

[Source: docs/architecture/01-system-architecture-document-saral-vyapar.md#4.3 Database (Persistence)]

### API Specifications

**Settings Endpoints:**

- `GET /api/settings` - Get all shop settings
- `PUT /api/settings` - Update shop settings
- `GET /api/settings/profile` - Get shop profile
- `PUT /api/settings/profile` - Update shop profile
- `GET /api/settings/tax` - Get tax configuration
- `PUT /api/settings/tax` - Update tax configuration
- `GET /api/settings/business-hours` - Get business hours
- `PUT /api/settings/business-hours` - Update business hours
- `POST /api/settings/export` - Export business data

**Data Export Endpoints:**

- `POST /api/settings/export/products` - Export product catalog
- `POST /api/settings/export/sales` - Export sales data
- `POST /api/settings/export/customers` - Export customer data
- `POST /api/settings/export/bills` - Export bill history

### Component Specifications

**Frontend Components:**

- `SettingsLayout` - Main settings page with navigation
- `ShopProfileForm` - Shop profile editing form
- `TaxSettings` - Tax rate and rule configuration
- `BusinessHours` - Weekly schedule and holiday management
- `DashboardSettings` - Dashboard customization controls
- `NotificationSettings` - Notification preferences
- `DataExport` - Data export and backup functionality
- `SettingsNavigation` - Settings page navigation menu

**Settings Navigation Structure:**

```
Settings
├── Shop Profile
│   ├── Basic Information
│   ├── Logo & Branding
│   └── Contact Details
├── Tax & Pricing
│   ├── Tax Rates
│   ├── Tax Rules
│   └── Exemptions
├── Business Hours
│   ├── Weekly Schedule
│   ├── Holidays
│   └── Special Days
├── Dashboard
│   ├── Layout
│   ├── Widgets
│   └── Theme
├── Notifications
│   ├── Email Preferences
│   ├── Alert Settings
│   └── Report Frequency
└── Data Management
    ├── Export Data
    ├── Backup
    └── Restore
```

### File Locations

- `src/components/settings/SettingsLayout.tsx`
- `src/components/settings/ShopProfileForm.tsx`
- `src/components/settings/TaxSettings.tsx`
- `src/components/settings/BusinessHours.tsx`
- `src/components/settings/DashboardSettings.tsx`
- `src/components/settings/NotificationSettings.tsx`
- `src/components/settings/DataExport.tsx`
- `src/components/settings/SettingsNavigation.tsx`
- `src/pages/Settings.tsx`
- `src/pages/settings/Profile.tsx`
- `src/pages/settings/Tax.tsx`
- `src/pages/settings/BusinessHours.tsx`
- `src/pages/settings/Dashboard.tsx`
- `src/pages/settings/Notifications.tsx`
- `src/pages/settings/DataManagement.tsx`
- `src/api/settings.ts` - Settings API functions
- `src/utils/settingsUtils.ts` - Settings validation and helpers

### Testing Requirements

**Test Coverage:**

- Unit tests for all settings components
- Form validation testing for all setting types
- API integration tests for settings CRUD operations
- Business logic testing (tax calculations, business hours)
- Data export functionality testing
- Settings persistence and caching testing

### Technical Constraints

**Validation Requirements:**

- Shop name: Required, 2-100 characters
- GST number: Valid Indian GST format if provided
- Tax rate: 0-100%, numeric validation
- Business hours: Valid time format (HH:MM), no overlapping hours
- Email: Valid email format if provided

**Business Logic:**

- Tax calculation: Based on configured rate and rules
- Business hours: Operating schedule validation
- Dashboard layout: Widget positioning and sizing rules
- Notifications: Frequency and delivery method preferences

**Performance Considerations:**

- Settings caching: Store in localStorage for faster access
- Real-time updates: Settings changes reflect immediately
- Data export: Background processing for large exports
- Validation: Client-side validation with server confirmation

**Security Requirements:**

- Settings access: Shop owner only
- Data export: Secure file generation and download
- Profile updates: Validation and sanitization
- Backup data: Encrypted storage and transmission

## Testing

**Testing Standards:**

- Unit tests for all settings components using React Testing Library
- Form validation testing with various input scenarios
- API integration tests with mocked endpoints
- Business logic testing for tax and business hours
- Data export functionality testing
- Settings persistence and caching testing
- Responsive design testing across different screen sizes

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-27 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_This section will be populated by the QA agent during review_
